<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Rongfei" />
        <meta name="copyright" content="Rongfei" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="logging, python, " />

<meta property="og:title" content="python日志模块logging使用 "/>
<meta property="og:url" content="/pythonri-zhi-mo-kuai-loggingshi-yong.html" />
<meta property="og:description" content="" />
<meta property="og:site_name" content="LearnDevOps" />
<meta property="og:article:author" content="Rongfei" />
<meta property="og:article:published_time" content="2016-07-27T00:00:00+08:00" />
<meta name="twitter:title" content="python日志模块logging使用 ">
<meta name="twitter:description" content="">

        <title>python日志模块logging使用  · LearnDevOps
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/custom.css" media="screen">
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="/"><span class=site-name>LearnDevOps</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="">Home</a></li>
                            <li ><a href="/pages/about-me.html">About Me</a></li>
                            <li ><a href="/categories.html">Categories</a></li>
                            <li ><a href="/tags.html">Tags</a></li>
                            <li ><a href="/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="/pythonri-zhi-mo-kuai-loggingshi-yong.html"> python日志模块logging使用  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            
            <ol>
<li>logging介绍</li>
</ol>
<p>Python的logging模块提供了通用的日志系统，可以方便第三方模块或者是应用使用。这个模块提供不同的日志级别，并可以采用不同的方式记录日志，比如file，HTTP GET/POST，SMTP，Socket等，甚至可以自己实现具体的日志记录方式。</p>
<p>logging模块提供logger，handler，filter，formatter</p>
<ul>
<li>
<p>logger 记录器：
  提供日志接口，供应用代码使用。logger最长用的操作有两类：配置和发送日志消息。可以通过logging.getLogger(name)获取logger对象，如果不指定name则返回root对象，多次使用相同的name调用getLogger方法返回同一个logger对象。</p>
</li>
<li>
<p>handler 处理器：
  将日志记录（log record）发送到合适的目的地（destination），比如文件，socket等。一个logger对象可以通过addHandler方法添加0到多个handler，每个handler又可以定义不同日志级别，以实现日志分级过滤显示。常用的handeler有：StreamHandler，FileHandler，NullHandler</p>
</li>
<li>
<p>filter 过滤器：
  提供了更好的粒度控制，它可以决定输出哪些日志记录</p>
</li>
<li>
<p>formatter 格式化器：
  指定日志记录输出的具体格式。formatter的构造方法需要两个参数：消息的格式字符串和日期字符串，这两个参数都是可选的。</p>
</li>
</ul>
<!-- logger，handler和日志消息的调用可以有具体的日志级别（Level），只有在日志消息的级别大于logger和handler的级别。 -->

<p>日志级别：</p>
<p>logging日志级别为debug,info,warn,error,critical.logging默认为warn级别</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>| 级别    |何时使用|
| -------|-----------|
| DEBUG |详细信息，典型地调试问题时会感兴趣|
| INFO    |证明事情按预期工作|
| WARNING|  表明发生了一些意外，或者不久的将来会发生问题（如‘磁盘满了’）软件还是在正常工作。|
| ERROR |由于更严重的问题，软件已不能执行一些功能了|
| CRITICAL| 严重错误，表明软件已不能继续运行了|
</pre></div>


<p>现看最简单的日志运行：
在终端中演示：</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>In [<span style="color: #666666">1</span>]:   <span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">logging</span>

In [<span style="color: #666666">2</span>]:   logging<span style="color: #666666">.</span>debug(<span style="color: #BB4444">&#39;debug message&#39;</span>)

In [<span style="color: #666666">3</span>]:   logging<span style="color: #666666">.</span>info(<span style="color: #BB4444">&#39;info message&#39;</span>)

In [<span style="color: #666666">4</span>]:   logging<span style="color: #666666">.</span>warn(<span style="color: #BB4444">&#39;warn message&#39;</span>)
WARNING:root:warn message

In [<span style="color: #666666">5</span>]:   logging<span style="color: #666666">.</span>error(<span style="color: #BB4444">&#39;error message&#39;</span>)
ERROR:root:error message

In [<span style="color: #666666">6</span>]:   logging<span style="color: #666666">.</span>critical(<span style="color: #BB4444">&#39;critical message&#39;</span>)
CRITICAL:root:critical message
</pre></div>


<p>看到前面的输出debug和info并没有输出，我们增加一个level设置,这次写在log.py 文件中。</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008800; font-style: italic">#!/usr/local/bin/python</span>
<span style="color: #008800; font-style: italic"># -*- coding:utf-8 -*-</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">logging</span>
logging<span style="color: #666666">.</span>basicConfig(filename<span style="color: #666666">=</span><span style="color: #BB4444">&#39;logging.log&#39;</span>,level<span style="color: #666666">=</span>logging<span style="color: #666666">.</span>DEBUG)
logging<span style="color: #666666">.</span>debug(<span style="color: #BB4444">&#39;debug message&#39;</span>)
logging<span style="color: #666666">.</span>info(<span style="color: #BB4444">&#39;info message&#39;</span>)
logging<span style="color: #666666">.</span>warn(<span style="color: #BB4444">&#39;warn message&#39;</span>)
logging<span style="color: #666666">.</span>error(<span style="color: #BB4444">&#39;error message&#39;</span>)
logging<span style="color: #666666">.</span>critical(<span style="color: #BB4444">&#39;critical message&#39;</span>)
</pre></div>


<p>查看输出：</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>$ python log.py
$ cat logging.log
DEBUG:root:debug message
INFO:root:info message
WARNING:root:warn message
ERROR:root:error message
CRITICAL:root:critical message
</pre></div>


<p>这次就有来debug和info信息,</p>
<!--

- logger：

创建方法: ｀logger = logging.getLogger(logger_name)｀
设置日志级别: logger.setLevel(logging.DEBUG)
增加handler: logger.addHandler(handler_name)
删除handler: logger.removeHandler(handler_name)

- handler

Handler处理器类型有很多种，比较常用的有三个，StreamHandler 输出到屏幕，FileHandler输出到文件，NullHandler

创建StreamHandler之后，可以通过使用以下方法设置日志级别，设置格式化器Formatter，增加或删除过滤器Filter。

StreamHandler创建方法:
sh = logging.StreamHandler(stream=None)
sh.setLevel(logging.WARN) # 指定日志级别，低于WARN级别的日志将被忽略
sh.setFormatter(formatter_name) # 设置一个格式化器formatter
sh.addFilter(filter_name) # 增加一个过滤器，可以增加多个
sh.removeFilter(filter_name) # 删除一个过滤器


FileHandler创建方法:
fh = logging.FileHandler(filename, mode='a', encoding='utf8', delay=False)

NullHandler
NullHandler类位于核心logging包，不做任何的格式化或者输出。
本质上它是个“什么都不做”的handler，由库开发者使用。
-->

<p>日志配置方式：</p>
<p>显式创建记录器Logger、处理器Handler和格式化器Formatter，并进行相关设置；</p>
<p>通过简单方式进行配置，使用basicConfig()函数直接进行配置；</p>
<p>通过配置文件进行配置，使用fileConfig()函数读取配置文件；</p>
<p>通过配置字典进行配置，使用dictConfig()函数读取配置信息；</p>
<p>通过网络进行配置，使用listen()函数进行网络配置。</p>
<p>basicConfig关键字参数</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>关键字       描述
filename    创建一个FileHandler，使用指定的文件名，而不是使用StreamHandler。
filemode    如果指明了文件名，指明打开文件的模式（如果没有指明filemode，默认为&#39;a&#39;）。
format    handler使用指明的格式化字符串。
datefmt   使用指明的日期／时间格式。
level       指明根logger的级别。
stream    使用指明的流来初始化StreamHandler。该参数与&#39;filename&#39;不兼容，如果两个都有，&#39;stream&#39;被忽略。
</pre></div>


<p>有用的format格式</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>格式  描述
%(levelno)s 打印日志级别的数值
%(levelname)s   打印日志级别名称
%(pathname)s    打印当前执行程序的路径
%(filename)s    打印当前执行程序名称
%(funcName)s    打印日志的当前函数
%(lineno)d  打印日志的当前行号
%(asctime)s 打印日志的时间
%(thread)d  打印线程id
%(threadName)s  打印线程名称
%(process)d 打印进程ID
%(message)s 打印日志信息
</pre></div>


<p>有用的datefmt格式:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>Directive   Meaning Notes
%a  Locale’s abbreviated weekday name.
%A  Locale’s full weekday name.
%b  Locale’s abbreviated month name.
%B  Locale’s full month name.
%c  Locale’s appropriate date and time representation.
%d  Day of the month as a decimal number [01,31].
%H  Hour (24-hour clock) as a decimal number [00,23].
%I  Hour (12-hour clock) as a decimal number [01,12].
%j  Day of the year as a decimal number [001,366].
%m  Month as a decimal number [01,12].
%M  Minute as a decimal number [00,59].
%p  Locale’s equivalent of either AM or PM. (1)
%S  Second as a decimal number [00,61]. (2)
%U  Week number of the year (Sunday as the first day of the week) as a decimal number [00,53]. All days in a new year preceding the first Sunday are considered to be in week 0.    (3)
%w  Weekday as a decimal number [0(Sunday),6].
%W  Week number of the year (Monday as the first day of the week) as a decimal number [00,53]. All days in a new year preceding the first Monday are considered to be in week 0.    (3)
%x  Locale’s appropriate date representation.
%X  Locale’s appropriate time representation.
%y  Year without century as a decimal number [00,99].
%Y  Year with century as a decimal number.
%Z  Time zone name (no characters if no time zone exists).
%%  A literal &#39;%&#39; character.
</pre></div>


<p>配置示例
显式配置
使用程序logger.py如下:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008800; font-style: italic"># -*- encoding:utf-8 -*-</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">logging</span>

<span style="color: #008800; font-style: italic"># create logger</span>
logger_name <span style="color: #666666">=</span> <span style="color: #BB4444">&quot;example&quot;</span>
logger <span style="color: #666666">=</span> logging<span style="color: #666666">.</span>getLogger(logger_name)
logger<span style="color: #666666">.</span>setLevel(logging<span style="color: #666666">.</span>DEBUG)

<span style="color: #008800; font-style: italic"># create file handler</span>
log_path <span style="color: #666666">=</span> <span style="color: #BB4444">&quot;./log.log&quot;</span>
fh <span style="color: #666666">=</span> logging<span style="color: #666666">.</span>FileHandler(log_path)
fh<span style="color: #666666">.</span>setLevel(logging<span style="color: #666666">.</span>WARN)

<span style="color: #008800; font-style: italic"># create formatter</span>
fmt <span style="color: #666666">=</span> <span style="color: #BB4444">&quot;</span><span style="color: #BB6688; font-weight: bold">%(asctime)-15s</span><span style="color: #BB4444"> </span><span style="color: #BB6688; font-weight: bold">%(levelname)s</span><span style="color: #BB4444"> </span><span style="color: #BB6688; font-weight: bold">%(filename)s</span><span style="color: #BB4444"> </span><span style="color: #BB6688; font-weight: bold">%(lineno)d</span><span style="color: #BB4444"> </span><span style="color: #BB6688; font-weight: bold">%(process)d</span><span style="color: #BB4444"> </span><span style="color: #BB6688; font-weight: bold">%(message)s</span><span style="color: #BB4444">&quot;</span>
datefmt <span style="color: #666666">=</span> <span style="color: #BB4444">&quot;%a </span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BB4444"> %b %Y %H:%M:%S&quot;</span>
formatter <span style="color: #666666">=</span> logging<span style="color: #666666">.</span>Formatter(fmt, datefmt)

<span style="color: #008800; font-style: italic"># add handler and formatter to logger</span>
fh<span style="color: #666666">.</span>setFormatter(formatter)
logger<span style="color: #666666">.</span>addHandler(fh)

<span style="color: #008800; font-style: italic"># print log info</span>
logger<span style="color: #666666">.</span>debug(<span style="color: #BB4444">&#39;debug message&#39;</span>)
logger<span style="color: #666666">.</span>info(<span style="color: #BB4444">&#39;info message&#39;</span>)
logger<span style="color: #666666">.</span>warn(<span style="color: #BB4444">&#39;warn message&#39;</span>)
logger<span style="color: #666666">.</span>error(<span style="color: #BB4444">&#39;error message&#39;</span>)
logger<span style="color: #666666">.</span>critical(<span style="color: #BB4444">&#39;critical message&#39;</span>)
</pre></div>


<p>文件配置
配置文件logging.conf如下:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008800; font-style: italic"># -*- encoding:utf-8 -*-</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">logging</span>

<span style="color: #008800; font-style: italic"># create logger</span>
logger_name <span style="color: #666666">=</span> <span style="color: #BB4444">&quot;example&quot;</span>
logger <span style="color: #666666">=</span> logging<span style="color: #666666">.</span>getLogger(logger_name)
logger<span style="color: #666666">.</span>setLevel(logging<span style="color: #666666">.</span>DEBUG)

<span style="color: #008800; font-style: italic"># create file handler</span>
log_path <span style="color: #666666">=</span> <span style="color: #BB4444">&quot;./log.log&quot;</span>
fh <span style="color: #666666">=</span> logging<span style="color: #666666">.</span>FileHandler(log_path)
fh<span style="color: #666666">.</span>setLevel(logging<span style="color: #666666">.</span>WARN)

<span style="color: #008800; font-style: italic"># create formatter</span>
fmt <span style="color: #666666">=</span> <span style="color: #BB4444">&quot;</span><span style="color: #BB6688; font-weight: bold">%(asctime)-15s</span><span style="color: #BB4444"> </span><span style="color: #BB6688; font-weight: bold">%(levelname)s</span><span style="color: #BB4444"> </span><span style="color: #BB6688; font-weight: bold">%(filename)s</span><span style="color: #BB4444"> </span><span style="color: #BB6688; font-weight: bold">%(lineno)d</span><span style="color: #BB4444"> </span><span style="color: #BB6688; font-weight: bold">%(process)d</span><span style="color: #BB4444"> </span><span style="color: #BB6688; font-weight: bold">%(message)s</span><span style="color: #BB4444">&quot;</span>
datefmt <span style="color: #666666">=</span> <span style="color: #BB4444">&quot;%a </span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BB4444"> %b %Y %H:%M:%S&quot;</span>
formatter <span style="color: #666666">=</span> logging<span style="color: #666666">.</span>Formatter(fmt, datefmt)

<span style="color: #008800; font-style: italic"># add handler and formatter to logger</span>
fh<span style="color: #666666">.</span>setFormatter(formatter)
logger<span style="color: #666666">.</span>addHandler(fh)

<span style="color: #008800; font-style: italic"># print log info</span>
logger<span style="color: #666666">.</span>debug(<span style="color: #BB4444">&#39;debug message&#39;</span>)
logger<span style="color: #666666">.</span>info(<span style="color: #BB4444">&#39;info message&#39;</span>)
logger<span style="color: #666666">.</span>warn(<span style="color: #BB4444">&#39;warn message&#39;</span>)
logger<span style="color: #666666">.</span>error(<span style="color: #BB4444">&#39;error message&#39;</span>)
logger<span style="color: #666666">.</span>critical(<span style="color: #BB4444">&#39;critical message&#39;</span>)
</pre></div>


<p>文件配置
配置文件logging.conf如下:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>keys<span style="color: #666666">=</span>root,example01

[logger_root]
level<span style="color: #666666">=</span>DEBUG
handlers<span style="color: #666666">=</span>hand01,hand02

[logger_example01]
handlers<span style="color: #666666">=</span>hand01,hand02
qualname<span style="color: #666666">=</span>example01
propagate<span style="color: #666666">=0</span>

[handlers]
keys<span style="color: #666666">=</span>hand01,hand02

[handler_hand01]
class<span style="color: #666666">=</span>StreamHandler
level<span style="color: #666666">=</span>INFO
formatter<span style="color: #666666">=</span>form02
args<span style="color: #666666">=</span>(sys<span style="color: #666666">.</span>stderr,)

[handler_hand02]
class<span style="color: #666666">=</span>FileHandler
level<span style="color: #666666">=</span>DEBUG
formatter<span style="color: #666666">=</span>form01
args<span style="color: #666666">=</span>(<span style="color: #BB4444">&#39;log.log&#39;</span>, <span style="color: #BB4444">&#39;a&#39;</span>)

[formatters]
keys<span style="color: #666666">=</span>form01,form02

[formatter_form01]
format<span style="color: #666666">=%</span>(asctime)s <span style="color: #666666">%</span>(filename)s[line:<span style="color: #666666">%</span>(lineno)d] <span style="color: #666666">%</span>(levelname)s <span style="color: #666666">%</span>(message)s
</pre></div>


<p>使用程序logger.py如下:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008800; font-style: italic"># -*- encoding:utf-8 -*-</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">logging</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">logging.config</span>

logging<span style="color: #666666">.</span>config<span style="color: #666666">.</span>fileConfig(<span style="color: #BB4444">&quot;./logging.conf&quot;</span>)

<span style="color: #008800; font-style: italic"># create logger</span>
logger_name <span style="color: #666666">=</span> <span style="color: #BB4444">&quot;example&quot;</span>
logger <span style="color: #666666">=</span> logging<span style="color: #666666">.</span>getLogger(logger_name)

logger<span style="color: #666666">.</span>debug(<span style="color: #BB4444">&#39;debug message&#39;</span>)
logger<span style="color: #666666">.</span>info(<span style="color: #BB4444">&#39;info message&#39;</span>)
logger<span style="color: #666666">.</span>warn(<span style="color: #BB4444">&#39;warn message&#39;</span>)
logger<span style="color: #666666">.</span>error(<span style="color: #BB4444">&#39;error message&#39;</span>)
logger<span style="color: #666666">.</span>critical(<span style="color: #BB4444">&#39;critical message&#39;</span>)
</pre></div>
            
            
            <hr/>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2016-07-27T00:00:00+08:00">7月 27, 2016</time>
            <h4>Category</h4>
            <a class="category-link" href="/categories.html#python-ref">python</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="/tags.html#logging-ref">logging
                    <span>1</span>
</a></li>
            </ul>
        </div>
        </section>
</div>

<!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="python日志模块logging使用" data-title="python日志模块logging使用" data-url="http://blog.pyshell.cn/pythonri-zhi-mo-kuai-loggingshi-yong.html"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"devops"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->
<!-- baidu tongji   -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?b6fb6111b823b418109202b642b4a62b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<!-- baidu tongji  end -->

</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    
    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>